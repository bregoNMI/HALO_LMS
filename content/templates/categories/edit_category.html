{% extends 'base.html' %}
{% load static %}
{% block content %}
    {% include 'messageContainer/message_container.html' %}
    <div id="stickyNavBar">
        <div class="details-top-row max-width-extend-1">
            <div class="details-top-row-left">
                <button type="button" onclick="handleBackButton()" class="back-btn dynamic-back-btn">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h3> Edit Category </h3>
            </div>
            <div class="details-top-row-right">
                <div class="option-btn-row">
                    <button id="createCategoryBtn" class="action-button-primary create-category-btn course-save-btns">
                        <i class="fa-regular fa-paper-plane"></i>
                        <span>Create Category</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="admin-body align-center">
        <div class="max-width-extend-1">
            <div id="mainNavBar" class="details-top-row">
                <div class="details-top-row-left">
                    <button type="button" onclick="handleBackButton()" class="back-btn dynamic-back-btn">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                    <h3> Edit Category </h3>
                </div>
                <div class="details-top-row-right">
                    <div class="option-btn-row">
                        <button id="createCategoryBtn" class="action-button-primary course-save-btns create-category-btn">
                            <i class="fa-regular fa-floppy-disk"></i>
                            <span>Save Changes</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="course-content-container margin-top-10">
                <!-- Left Column -->
                <div class="course-content-left-column">
                    <div class="details-info-card">
                        <div class="info-card-header collapsable-header">
                            <div class="card-header-left">
                                <i class="fa-regular fa-grid-2-plus"></i>
                                <span> Category Details </span>
                            </div>
                            <div class="card-header-right">
                                <i class="fa-regular fa-angle-down"></i>
                            </div>
                        </div>
                        <!-- This is the category ID that gets sent to edit -->
                            <input type="hidden" id="categoryId" value="{{ category.id }}">
                        <div class="info-card-body">
                            <div class="edit-user-input">
                                <label class="edit-user-label" for="category">Parent Category</label>
                                <div id="selectedCategories">
                                    <div class="right-column-file-wrapper">
                                        <div id="userDropdown2" class="category-dropdown course-content-input">
                                            <input type="text" id="category" name="category" class="categorySearch" placeholder="Search categories..." autocomplete="off" value="{{ category.parent_category.name }}" data-id="{{ category.parent_category.id }}">
                                            <i class="fa-regular fa-magnifying-glass search-icon"></i>
                                            <div class="categoryList scrollable-content-inner">
                                                <div class="loadingIndicator" style="display:none;">Loading...</div>
                                            </div>
                                            <div class="dropdown-clear-input">
                                                <i class="fa-solid fa-xmark"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="course-content-input">
                                <label class="edit-user-label" for="name">Name<span class="required-asterisk">*</span></label>
                                <input type="text" id="name" name="name" placeholder="Name" value="{{ category.name }}">
                            </div>
                            <div class="course-content-input">
                                <label class="edit-user-label" for="description">Description</label>
                                <div class="editor-container" id="description"> {{ category.description|safe }} </div>
                                <div class="quill-character-counter">
                                    <div class="quill-current-counter">0</div>
                                    <span>/</span>
                                    <div class="quill-max-counter">2000</div>
                                </div>
                            </div>    
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'client_admin\javascript\ajax_search_options.js' %}"></script>
    <link rel="stylesheet" href="{% static 'content\css\content.css' %}">
    <link rel="stylesheet" href="{% static 'client_admin\css\user_details.css' %}">
    <script src="{% static 'client_admin\javascript\popups.js' %}"></script>
    <script src="{% static 'client_admin\javascript\custom_select.js' %}"></script>
    <script src="{% static 'client_admin\javascript\user_details.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const nameInput = document.getElementById('name');
            const editCategoryButtons = document.querySelectorAll('.create-category-btn');

            nameInput.addEventListener('keyup', function () {
                editCategoryButtons.forEach(btn => {
                    if (this.value.trim().length >= 1) {
                        btn.classList.remove('disabled');
                        btn.removeAttribute('disabled');
                    } else {
                        btn.classList.add('disabled');
                        btn.setAttribute('disabled', true);
                    }
                });
            });

            editCategoryButtons.forEach(btn => {
                btn.addEventListener('click', function () {
                    const parentCategory = document.getElementById('category').getAttribute('data-id');
                    const categoryName = nameInput.value.trim();
                    const categoryDescription = getEditorContent('description');
                    const id = document.getElementById('categoryId').value;
                    if (categoryName) {
                        editCategory(id, parentCategory, categoryName, categoryDescription, true);

                        editCategoryButtons.forEach(button => {
                            button.classList.add('disabled');
                            button.setAttribute('disabled', true);
                        });
                        setDisabledSaveBtns();
                    } else {
                        alert('Please enter a category name.');
                    }
                });
            });
        });
    </script>
{% endblock content %}