{% extends 'base.html' %}
{% load static %}
{% block content %}
    {% if messages %}
        <div class="alert-container">
            {% for message in messages %}
                {% if message.tags == 'success' %}
                    <div class="alert alert-{{ message.tags }}">
                        <i class="fa-solid fa-circle-check"></i>
                        {{ message }}
                    </div>
                {% elif message.tags == 'error' %}
                    <div class="alert alert-{{ message.tags }}">
                        <i class="fa-solid fa-circle-xmark"></i>
                        {{ message }}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
    <div id="stickyNavBar">
        <div class="details-top-row max-width-0">
            <div class="details-top-row-left">
                <button type="button" onclick="handleBackButton()" class="back-btn dynamic-back-btn">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h3> User Transcript </h3>
            </div>
            <div class="details-top-row-right">
                <div class="option-btn-row">
                    <div class="option-btn" onclick="messageUserBtn()">
                        <i class="fa-regular fa-messages"></i>
                        <span> Message user</span>
                    </div>
                </div>
                <div class="option-btn-row">
                    <div class="option-btn" onclick="enrollUserBtn()">
                        <i class="fa-regular fa-hand-holding-box"></i>
                        <span> Enroll user</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="admin-body align-center">
        <div class="max-width-0">
            <div id="mainNavBar" class="details-top-row">
                <div class="details-top-row-left">
                    <button type="button" onclick="handleBackButton()" class="back-btn dynamic-back-btn">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                    <h3> User Transcript </h3>
                </div>
                <div class="details-top-row-right">
                    <div class="option-btn-row">
                        <div class="option-btn" onclick="messageUserBtn()">
                            <i class="fa-regular fa-messages"></i>
                            <span> Message user</span>
                        </div>
                    </div>
                    <div class="option-btn-row">
                        <div class="option-btn" onclick="enrollUserBtn()">
                            <i class="fa-regular fa-hand-holding-box"></i>
                            <span> Enroll user</span>
                        </div>
                    </div>
                </div>
            </div>
            {% include 'users/user_details_card.html' %}
            <div class="details-nav-menu">
                <a href="{% url 'user_details' profile.id %}" class="nav-menu-item">
                    <i class="fa-light fa-globe"></i>
                    <span> Overview </span>
                </a>
                <a href="{% url 'user_transcript' profile.id %}" class="nav-menu-item active">
                    <i class="fa-light fa-memo-pad"></i>
                    <span> Transcript </span>
                </a>
                <a href="{% url 'user_history' profile.id %}" class="nav-menu-item">
                    <i class="fa-light fa-clock-rotate-left"></i>
                    <span> History </span>
                </a>
            </div>
            <div class="details-info-section">
                <div class="details-info-card">
                    <div class="info-card-header collapsable-header">
                        <div class="card-header-left">
                            <!-- <i class="fa-regular fa-diploma"></i> -->
                            <i class="fa-regular fa-award"></i>
                            <span> Certificates </span>
                        </div>
                        <div class="card-header-right">
                            <i class="fa-regular fa-angle-down"></i>
                        </div>
                    </div>
                    <div class="info-card-body">
                        <div class="certificate-items-container">
                            {% for cert in user_certificates %}
                                <a href="{{ cert.file.url }}" class="certificate-item-wrapper" target="_blank">
                                    <div class="certificate-item-left">
                                        <i class="fa-light fa-file-certificate pastel-blue"></i>
                                    </div>
                                    <div class="certificate-item-right">
                                        <span class="certificate-item-title">{{ cert.user_course.course.certificate_title }}</span>
                                        <div class="course-item-footer">
                                            <div class="course-item-footer-item">
                                                <i class="fa-regular fa-calendar-check"></i>
                                                <span><b>Issued On:</b> {{ cert.issued_at.date }}</span>
                                            </div>
                                            {% for event in cert.event_dates.all %}
                                                {% if event.type == "certificate_expiration_date" %}
                                                    <div class="course-item-footer-item">
                                                        <i class="fa-solid fa-circle-small footer-spacer"></i>
                                                    </div>
                                                    <div class="course-item-footer-item">
                                                        <i class="fa-regular fa-calendar-clock"></i>
                                                        <span><b>Expires:</b> {{ event.date }}</span>
                                                    </div>
                                                {% endif %}
                                            {% endfor %}            
                                        </div>                                                                      
                                    </div>
                                </a>
                            {% empty %}
                                <span class="card-info-icon">Learner does not have any certificates yet.</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="details-info-section hidden" hidden>
                <div class="details-info-card">
                    <div class="info-card-header collapsable-header">
                        <div class="card-header-left">
                            <i class="fa-regular fa-trophy"></i>
                            <span> Badges & Tokens </span>
                        </div>
                        <div class="card-header-right">
                            <i class="fa-regular fa-angle-down"></i>
                        </div>
                    </div>
                    <div class="info-card-body">
                        <div class="info-card-column">
                            <div class="card-body-item">
                                <div class="card-body-left">
                                    <i class="fa-light fa-treasure-chest"></i>
                                </div>
                                <div class="card-body-right">
                                    <h5> Badges Earned </h5>
                                    <span>10</span>
                                </div>
                            </div>
                        </div>
                        <div class="info-card-column">
                            <div class="card-body-item">
                                <div class="card-body-left">
                                    <i class="fa-light fa-coin"></i>
                                </div>
                                <div class="card-body-right">
                                    <h5> Tokens Earned </h5>
                                    <span> 4,000 </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="details-info-section">
                <div class="details-info-card details-info-card-overflow-hidden">
                    <div class="info-card-header collapsable-header">
                        <div class="card-header-left">
                            <i class="fa-regular fa-pallet-box"></i>
                            <span> Enrollments </span>
                        </div>
                        <div class="card-header-right">
                            <i class="fa-regular fa-angle-down"></i>
                        </div>
                    </div>
                    {% if user_courses %}
                        <div style="border: 0;" class="info-card-body padding-0 scrollable-content">
                            <table>
                                <thead>      
                                    <tr>
                                        <th>Course Name</th>
                                        <th style="width: 12%;">Status</th>
                                        <th>% Complete</th>
                                        <th>Enrollment Date</th>
                                        <th>Time Spent</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                    {% for user_course in user_courses %}
                                        <tr class="table-select-option clickable-row" data-href="{% url 'usercourse_detail_view' uuid=user_course.uuid %}">
                                            <td>
                                                {% if user_course.course.type == 'online' %}
                                                    <div class="course-type-icon online-course tooltip" data-tooltip="Online Course">
                                                        <!-- <span class="tooltiptext"></span> -->
                                                        <i class="fa-solid fa-signal-bars"></i>         
                                                    </div>         
                                                {% else %}
                                                    <div class="course-type-icon inperson-course tooltip" data-tooltip="In Person Course">
                                                        <!-- <span class="tooltiptext"></span> -->
                                                        <i class="fa-solid fa-chalkboard-user"></i>                   
                                                    </div>
                                                {% endif %}
                                                <span class="course-name">{{ user_course.course.title }}</span>                                
                                            </td>
                                            {% if user_course.get_status == 'Not Started' %}
                                                <td><span class="status course-active pastel-gray"> Not Started </span></td>
                                            {% elif user_course.get_status == 'Started' %}
                                                <td><span class="status course-active pastel-yellow"> In Progress </span></td>
                                            {% elif user_course.get_status == 'Completed' %}
                                                <td><span class="status course-active pastel-green"> Completed </span></td>
                                            {% elif user_course.get_status == 'Not Completed' %}
                                                <td><span class="status course-active pastel-gray"> Not Completed </span></td> 
                                            {% elif user_course.get_status == 'Scheduled' %}
                                                <td><span class="status course-active pastel-yellow"> Scheduled </span></td>
                                            {% elif user_course.get_status == 'Expired' %}
                                                <td><span class="status course-active pastel-red"> Expired </span></td>
                                            {% elif user_course.get_status == 'Overdue' %}
                                                <td><span class="status course-active pastel-yellow"> Overdue </span></td>
                                            {% endif %}                                                          
                                            <td>{{ user_course.progress }}%</td>
                                            <td>{{ user_course.enrollment_date }}</td>
                                            <td>{{ user_course.get_scorm_total_time }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div style="border: 0;" class="info-card-body padding-0">
                            <div class="no-results-found-small">
                                <img src="/static/client_admin/Images/HALO%20LMS%20No%20Graphic%20Test-30.png" alt="HALO Graphic">    
                                <span>User is not enrolled in any courses</span>          
                            </div>
                        </div>                   
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% include 'popups/edit_user_popup.html' %}
    <link rel="stylesheet" href="{% static 'client_admin\css\user_details.css' %}">
    <link rel="stylesheet" href="{% static 'client_admin\css\user_course_details.css' %}">
    <script src="{% static 'client_admin\javascript\popups.js' %}"></script>
    <script src="{% static 'client_admin\javascript\user_details.js' %}"></script>
{% endblock content %}